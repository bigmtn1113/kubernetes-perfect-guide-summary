# 쿠버네티스 환경 선택

<br/>

## 쿠버네티스 환경의 종류
### 로컬 쿠버네티스
물리 머신 한 대에 구축하여 사용
- Minikube
- Docker Desktop for Mac/Windows
- kind(kubernetes in docker)

### 쿠버네티스 구축 도구
도구를 사용하여 온프레미스/클라우드에 클러스터를 구축하여 사용
- kubeadm
- Rancher

### 관리형 쿠버네티스 서비스
퍼블릭 클라우드의 관리형 서비스로 제공하는 클러스터를 사용
- GKE
- AKS
- EKS

<br/>

## 로컬 쿠버네티스
물리 머신에서 손쉽게 쿠버네티스를 테스트할 수 있는 방법  
한 대의 머신에 올인원으로 구성되어 이중화가 보장되지 않는 점 주의  
일부 사용할 수 없는 기능 존재

### Minikube
미니큐브로 실행되는 쿠버네티스는 단일 노드 구성이라 여러 대의 구성이 필요한 쿠버네티스 기능 등은 사용 불가  
로컬 가상 머신에 쿠버네티스를 설치하기 위해 하이퍼바이저 필요  
미니큐브로 구축한 쿠버네티스 클러스터(미니큐브 클러스터)는 다른 구축 방법과 마찬가지로 kubectl이라는 명령어 도구를 사용해 조작

### Docker Desktop for Mac/Windows
버전 18.06.0 CE부터 로컬 머신에서 쿠버네티스 사용 가능  
쿠버네티스 버전 지정 불가

### kind(kubernetes in docker)
쿠버네티스 자체 개발을 위한 도구  
도커 컨테이너를 여러 개 기동하고 그 컨테이너를 쿠버네티스 노드로 사용하는 것으로 여러 대로 구성된 쿠버네티스 클러스터 구축  
호스트에 기동 중인 도커 컨테이너를 확인해보면 노드 수만큼의 컨테이너 확인 가능

<br/>

## 쿠버네티스 구축 도구
### kubeadm
쿠버네티스에서 제공하는 공식 구축 도구

#### ※ Flannel
calico와 더불어 대표적인 CNI 플러그인

기본적으로 도커에서 기동한 컨테이너에 할당된 IP 주소는 호스트 외부에서 볼 수 없는 내부 주소라 각 노드에 배포된 컨테이너 간의 통신 불가  
이 문제를 해결하고 멀티 노드 쿠버네티스 클러스터를 구성하기 위해선 각 호스트의 내부 네트워크 접속성 확보 필요

플라넬은 노드 사이를 연결하는 네트워크에 가상 터널(오버레이 네트워크)을 구성하여 쿠버네티스 클러스터 내부의 파드 간 통신(파드 네트워크)이 가능하도록 구현

### Rancher
랜처 랩에서 개발하고 있는 오픈 소스 컨테이너 플랫폼  
중앙에서 랜처 서버를 기동시키고 관리자는 랜처 서버를 통해 쿠버네티스 클러스터를 구축 및 관리하는 구조  
실제 서비스 환경에서 랜처를 사용할 경우엔 DB 이중화나 랜처 서버 HA 구성 고려  
웹 UI 제공

<br/>

## 퍼블릭 클라우드 관리형 쿠버네티스 서비스
### EKS
AWS의 관리형 쿠버네티스 서비스

IAM과 쿠버네티스 사용자를 연결하여 IAM을 기반으로 권한을 관리할 수 있는 기능이나 파드 네트워크와 AWS VPC의 서브넷이 직접 연결되어 가상 머신에서 컨테이너로 직접 통신할 수 있는 네트워크 구성 가능

일반적으로 AWS가 제공하는 AMI에서 생성한 EC2 인스턴스를 쿠버네티스 노드로 사용  
AWS에서 공개한 Packer 설정과 스크립트를 사용하여 커스터마이즈한 AMI를 생성하고, 이 AMI로 EC2를 생성하여 쿠버네티스 노드로 사용 가능

운영 부하를 줄이고 싶다면 워커 노드 관리를 AWS에 맡기는 Managed Nodegroups나 AWS Fargate를 쿠버네티스 노드로 사용하는 EKS on Fargate 등 사용 가능
